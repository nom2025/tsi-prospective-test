# Tectonic Stress Index (TSI) — 凍結仕様書
# FROZEN SPECIFICATION — DO NOT MODIFY

**凍結日: 2026-02-14**
**凍結者: 研究者 + Claude (AI)**
**状態: LOCKED — この文書の数値・数式は前向き検証完了まで変更禁止**

---

## 1. 目的

TSIは「地震予測」ではなく「プレート応力場の状態推定」を目的とする。
測定対象は「地震の発生」ではなく「地殻が臨界状態にあるか否か」である。

## 2. 入力データ

| 項目 | 仕様 |
|---|---|
| データソース | 国土地理院 GNSS日座標 (F5解) |
| 観測点数 | 7局（固定） |
| 観測点ID | 950421, 950447, 950456, 950465, 950474, 950483, 950492 |
| 座標成分 | east_mm, north_mm, up_mm（基準点からの偏差、mm単位） |
| 時間分解能 | 日次 |

### 観測点一覧（固定）

| station_id | 名称 | 緯度 | 経度 |
|---|---|---|---|
| 950421 | 東京 | 35.6895 | 139.6917 |
| 950447 | 横浜 | 35.4437 | 139.6380 |
| 950456 | 静岡 | 34.9756 | 138.3826 |
| 950465 | 名古屋 | 35.1815 | 136.9066 |
| 950474 | 大阪 | 34.6937 | 135.5023 |
| 950483 | 神戸 | 34.6901 | 135.1956 |
| 950492 | 広島 | 34.3853 | 132.4553 |

## 3. 前処理

### 3.1 欠損補間
- 方法: 線形補間
- 最大補間日数: 7日
- 7日を超える欠損: NaN保持

### 3.2 座標系
- 各観測点の east_mm, north_mm, up_mm をそのまま使用
- 基準点座標からの偏差値（国土地理院提供値）

## 4. TSI計算式（凍結）

### 4.1 成分① 速度変化 (Velocity Change)

```
MA7[t]  = 7日中央移動平均（min_periods=4）
MA30[t] = 30日中央移動平均（min_periods=15）
VC[t]   = MA7[t] - MA30[t]

各観測点について:
  vc_east[t] = MA7(east_mm)[t] - MA30(east_mm)[t]
  vc_north[t] = MA7(north_mm)[t] - MA30(north_mm)[t]
  vc_horiz[t] = sqrt(vc_east[t]^2 + vc_north[t]^2)

広域指標:
  vc_horiz_mean[t] = mean(vc_horiz[t]) across all stations
```

### 4.2 成分② 空間的整合性 (Spatial Coherence)

```
各観測点の速度変化ベクトル v_i = (vc_east_i, vc_north_i) について:

1. 正規化: u_i = v_i / |v_i|  (|v_i|=0の場合は|v_i|=1で除算)
2. 平均単位ベクトル: u_mean = mean(u_i)
3. 整合性: coherence_vc[t] = |u_mean|

値域: 0（バラバラ）～ 1（全局同方向）
最低局数: 3局以上でのみ計算
```

### 4.3 成分③ 加速度 (Acceleration)

```
各観測点について:
  velocity_e[t] = 14日中央窓での east_mm の線形回帰傾き (mm/day)
                  (min_periods=7, numpy.polyfit degree=1)
  velocity_n[t] = 同様に north_mm

  accel_e[t] = (velocity_e[t] - velocity_e[t-7]) / 7
  accel_n[t] = (velocity_n[t] - velocity_n[t-7]) / 7
  accel_horiz[t] = sqrt(accel_e[t]^2 + accel_n[t]^2)

広域指標:
  accel_mean[t] = mean(accel_horiz[t]) across all stations
```

### 4.4 成分④ 低周波偏差 (Low-Frequency Anomaly)

```
MA30[t] の14日差分:
  lf_east[t] = MA30(east_mm)[t] - MA30(east_mm)[t-14]
  lf_north[t] = MA30(north_mm)[t] - MA30(north_mm)[t-14]
  lf_horiz[t] = sqrt(lf_east[t]^2 + lf_north[t]^2)

広域指標:
  lf_mean[t] = mean(lf_horiz[t]) across all stations
```

### 4.5 標準化（Zスコア）

**凍結パラメータ（2010-01-31 ～ 2025-12-25 のデータから算出）:**

| 成分 | mean | std |
|---|---|---|
| vc_horiz_mean | 2.8771487892 | 3.2528439241 |
| coherence_vc | 0.7471262423 | 0.2245541473 |
| accel_mean | 0.1238355949 | 0.1323451171 |
| lf_mean | 3.6413308546 | 5.9476394549 |

```
z_score[成分] = (成分[t] - mean) / std
```

**重要: 前向き検証期間中、mean/stdは上記の値を固定使用する。**
**新データで再計算してはならない。**

### 4.6 TSI合成

```
TSI[t] = (z_vc_horiz_mean[t] + z_coherence_vc[t] + z_accel_mean[t] + z_lf_mean[t]) / 4
```

- 重み: 全成分等重み (1/4)
- 重みの変更禁止

### 4.7 TSI平滑化

```
TSI_30d[t] = TSI の30日中央移動平均 (min_periods=15)
```

## 5. 警報閾値（凍結）

| 閾値 | 値 | 意味 |
|---|---|---|
| TSI_30d 95%ile | **0.6138** | 過去データの上位5%に相当 |

**この閾値を変更してはならない。**

## 6. 前向き検証プロトコル

### 6.1 検証開始日
**2026-02-14**

### 6.2 評価指標

| 指標 | 定義 |
|---|---|
| 的中率 (Precision) | TSI_30d ≥ 0.6138 のクラスタのうち、60日以内にM7+が発生した割合 |
| 捕捉率 (Recall) | M7+のうち、60日前以内にTSI_30d ≥ 0.6138 があった割合 |
| ベースレート | ランダムに同数の警報を出した場合の期待的中率 |

### 6.3 クラスタ定義
- TSI_30d ≥ 0.6138 の連続日（5日以内のギャップは同一クラスタ）

### 6.4 M7+の対象
- 世界 M7.0 以上（USGSカタログ準拠）
- 日本 M7.0 以上（気象庁カタログ準拠）

### 6.5 検証期間
- 最低6ヶ月（2026-08-14まで）
- 理想は12ヶ月（2027-02-14まで）

### 6.6 記録ルール
- 毎日のTSI値を prospective_log.csv に追記
- 値の遡及修正は禁止
- GNSSデータの遅延到着による欠損は NaN として記録

## 7. 過去データでの参考成績（後知恵、非エビデンス）

**注意: 以下は同一データで設計・検証した結果であり、科学的証拠ではない。**
**前向き検証の結果のみが科学的に有効である。**

- TSI_30d上位5%のクラスタ: 11個
- 60日以内にM7+発生: 10/11 (90.9%)
- ただしこれはデータスヌーピングの結果であり、前向き検証での期待値ではない

## 8. 変更履歴

| 日付 | 内容 |
|---|---|
| 2026-02-14 | 初版作成・凍結 |

---

**この文書は前向き検証の完了まで変更してはならない。**
**指標の「改良」は検証完了後にのみ許可される。**
**検証中に指標を変更した場合、その時点で検証は無効となる。**
