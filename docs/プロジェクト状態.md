# 地震データ分析システム - プロジェクト状態

**最終更新日**: 2026-01-24（GNSS・b値スコアの追加）

## 📋 プロジェクト概要

地震データを分析し、複数の指標に基づいてスコアを計算することで、地震活動の評価を行うシステムです。

## 📁 プロジェクト構成

```
52-2_cursor_地震/
├── scripts/                    # スクリプト類（整理済み）
│   ├── analysis/              # 分析スクリプト
│   │   ├── analyze_m7_precursor_patterns.py
│   │   ├── analyze_november.py
│   │   ├── check_m7_december.py
│   │   └── comprehensive_m7_analysis.py
│   ├── data_fetch/            # データ取得スクリプト（ラッパー）
│   │   ├── fetch_depth_data.py      # データ自動取得/src/ のスクリプトを呼び出す
│   │   ├── fetch_earthquake_data.py # データ自動取得/src/ のスクリプトを呼び出す
│   │   └── fetch_world_earthquake_data.py # データ自動取得/src/ のスクリプトを呼び出す
│   └── utils/                 # ユーティリティスクリプト
│       └── delete_unused_folders.py
│
├── docs/                      # ドキュメント類（整理済み）
│   ├── README.md
│   ├── プロジェクト状態.md    # このファイル
│   ├── 特徴探索ガイド.md
│   └── 整理計画.md
│
├── 生データ/                    # 入力データ
│   ├── 2010-all.csv            # 国内地震データ
│   ├── world-all.csv           # 世界地震データ
│   ├── depth.csv               # 深さデータ
│   └── gnss_data.csv           # GNSS地殻変動データ
│
├── ソース/                      # コア分析スクリプト
│   ├── calculate_scores.py     # スコア計算スクリプト
│   ├── create_graphs.py        # グラフ作成スクリプト
│   └── explore_features.py     # 特徴探索スクリプト
│
├── データ分析結果出力/          # 分析結果
│   ├── japan_scores.csv        # 国内地震スコア
│   ├── world_scores.csv        # 世界地震スコア
│   ├── depth_scores.csv        # 深さスコア
│   ├── gnss_scores.csv         # GNSSスコア
│   ├── b_value_scores.csv      # b値スコア
│   ├── total_with_gnss.csv     # 総合スコア（GNSS含む）
│   ├── total_no_gnss.csv       # 総合スコア（GNSSなし）
│   └── 特徴探索結果/            # 特徴探索の結果
│       ├── feature_exploration_report.md  # 特徴探索レポート
│       ├── m7_precursor_score_analysis.md  # M7前兆スコア分析レポート
│       ├── comprehensive_m7_analysis_report.md  # M7包括的分析レポート
│       ├── scientific_evaluation_report.md  # 科学的評価レポート
│       ├── 活用可能な特徴まとめ.md        # 活用可能な特徴のまとめ
│       ├── regional_statistics.csv       # 地域別統計
│       ├── regional_correlations.csv      # 地域間の相関
│       ├── magnitude_trends.csv           # マグニチュードトレンド
│       ├── pre_m7_patterns.csv            # M7発生前30日のパターン
│       ├── pre_m7_distribution_features.csv  # M7発生前の分布特徴
│       ├── post_world_m7_patterns.csv     # 世界M7発生後の国内地震パターン
│       ├── world_japan_correlation.csv    # 世界・国内地震の相関
│       ├── depth_category_statistics.csv   # 深さカテゴリ別統計
│       ├── depth_magnitude_relationship.csv  # 深さとマグニチュードの関係
│       ├── monthly_statistics.csv         # 月別統計
│       ├── seasonal_statistics.csv        # 季節別統計
│       ├── magnitude_distribution_features.csv  # 分布特徴量
│       └── consecutive_periods.csv        # 連続発生期間
│
├── グラフ/                      # 可視化結果
│   ├── total_score_timeseries.png
│   ├── total_score_histogram.png
│   ├── all_scores_comparison.png
│   ├── グラフ作成実行.bat        # グラフ作成バッチファイル（文字化け問題あり）
│   └── グラフ作成実行.ps1        # グラフ作成PowerShellスクリプト（推奨）
│
├── データ自動取得/              # データ自動取得スクリプト
│   ├── src/                    # データ取得スクリプト（実スクリプト）
│   │   ├── fetch_depth_data.py
│   │   ├── fetch_earthquake_data.py
│   │   ├── fetch_world_earthquake_data.py
│   │   └── YYYYMMDD/           # 作業フォルダ（日付別）
│   ├── data/                   # データファイル（自動更新）
│   │   ├── 2010-all.csv        # 国内地震データ
│   │   ├── world-all.csv       # 世界地震データ
│   │   ├── depth.csv           # 深さデータ
│   │   └── atmospheric.csv     # 気圧データ
│   ├── debug/                  # デバッグファイル
│   ├── YYYYMMDD/               # 作業フォルダ（日付別、旧形式）
│   ├── README.md               # データ自動取得の説明書
│   ├── organize_files.py       # ファイル整理スクリプト
│   └── update_paths.py         # パス更新スクリプト
│
├── 仕様書/                      # システム仕様書
│   └── 地震データ分析システム仕様書.md
│
├── 元のソース/                  # 元のソースコード
│   └── 元のソース.txt
│
├── requirements.txt            # Python依存パッケージ
├── organize_project.py         # プロジェクト整理スクリプト
├── 整理実行.bat                # 整理実行バッチファイル
└── グラフ再生成.bat            # グラフ再生成バッチファイル
```

## ✅ 完了した作業

### 1. 既存システムの実装
- ✅ 国内地震スコア計算（`calculate_scores.py`）
- ✅ 世界地震スコア計算
- ✅ 深さスコア計算
- ✅ GNSSスコア計算（地殻変動データに基づく）
- ✅ b値スコア計算（グーテンベルク・リヒター則に基づく）
- ✅ 総合スコア計算（国内+世界+深さ+GNSS+b値）
- ✅ グラフ作成機能（`create_graphs.py`）
  - ✅ 時系列グラフの改善（2025-12-21）
    - M7.5以上の地震を凡例として表示（以前はM6以上）
    - アノテーション（凡例）の配置を横方向に変更し、重ならないように改善

### 2. 特徴探索機能の追加（新規）
- ✅ 地域別パターン分析
- ✅ マグニチュードトレンド分析
- ✅ 地震発生間隔分析
- ✅ 世界地震と国内地震の相関分析
- ✅ 深さとマグニチュードの関係分析
- ✅ 季節性パターン分析
- ✅ マグニチュード分布の特徴量分析

### 3. ドキュメント作成
- ✅ 特徴探索ガイド（`特徴探索ガイド.md`）
- ✅ 活用可能な特徴まとめ（`データ分析結果出力/活用可能な特徴まとめ.md`）
- ✅ プロジェクト状態記録（このファイル）

### 4. データ自動取得機能の実装（新規追加）
- ✅ 国内地震データ自動取得
  - **実スクリプト**: `データ自動取得/src/fetch_earthquake_data.py`
  - **ラッパー**: `scripts/data_fetch/fetch_earthquake_data.py`（プロジェクトルートから実行可能）
  - Yahoo!天気・災害からデータを取得
  - `データ自動取得/data/2010-all.csv`に自動追加
  - 重複チェック機能
  - 日付別作業フォルダの作成（`データ自動取得/src/YYYYMMDD/`）
- ✅ 世界地震データ自動取得
  - **実スクリプト**: `データ自動取得/src/fetch_world_earthquake_data.py`
  - **ラッパー**: `scripts/data_fetch/fetch_world_earthquake_data.py`（プロジェクトルートから実行可能）
  - USGS Earthquake Catalog APIからデータを取得（M6.0以上）
  - `データ自動取得/data/world-all.csv`に自動追加
  - 最新日付からの自動継続取得
  - 重複チェック機能
- ✅ 深さデータ自動取得
  - **実スクリプト**: `データ自動取得/src/fetch_depth_data.py`
  - **ラッパー**: `scripts/data_fetch/fetch_depth_data.py`（プロジェクトルートから実行可能）
  - F-net（防災科研）からデータを取得（深さ300km以上）
  - `データ自動取得/data/depth.csv`に自動追加
  - Seleniumを使用したJavaScript対応
  - 直近2ヶ月の自動取得
  - 重複チェック機能（既存データとの重複、取得データ内の重複）
- ✅ データ自動取得のREADME作成（`データ自動取得/README.md`）

### 5. M7地震前兆パターン分析（新規追加）
- ✅ M7発生前30日のスコアパターン分析
  - 全26件のM7地震について前30日のスコアパターンを網羅的に分析
  - 10件以上の主要M7地震で明確な前兆パターンを確認（100%）
  - スコア6.0以上は約10日のみ出現し、M7発生日との関連性が非常に高い
  - スコア5.0以上は約25日のみ出現し、M7発生日との関連性が高い
- ✅ 偽陽性（高スコアだがM7が発生しなかったケース）の分析
  - スコア4.0以上で偽陽性が存在することを確認
  - 偽陽性の要因分析と特徴の把握
- ✅ スコア閾値の最適化分析
  - 閾値別の精度比較を実施
  - 最適閾値5.0を推奨
- ✅ 地域別のパターン差異分析
  - 7つの地域分類別の特徴を分析
  - 東北沖、北陸、熊本地方は発生日直前の高いスコア
  - 台湾付近はやや低めのスコアパターン
- ✅ 包括的分析レポート作成（`データ分析結果出力/特徴探索結果/comprehensive_m7_analysis_report.md`）
- ✅ 科学的評価レポート作成（`データ分析結果出力/特徴探索結果/scientific_evaluation_report.md`）

### 6. プロジェクトファイル整理（新規追加）
- ✅ スクリプトの整理
  - `scripts/analysis/`: 分析スクリプト（4ファイル）
  - `scripts/data_fetch/`: データ取得スクリプトのラッパー（3ファイル）
    - 実スクリプトは `データ自動取得/src/` に配置
  - `scripts/utils/`: ユーティリティスクリプト（1ファイル）
- ✅ ドキュメントの整理
  - `docs/`: ドキュメント類（4ファイル）
- ✅ 整理スクリプト作成（`organize_project.py`）

## 🔍 発見された主要な特徴

### 最重要（予測に直結）

1. **M7発生前30日のスコアパターン** ⭐⭐⭐⭐⭐
   - **発見**: M7発生前30日間に高スコアが出現する傾向が確認された
   - **統計**: 分析した10件の主要M7地震のうち、**10件全てで前兆パターンを確認**（100%）
   - **スコア6.0以上**: 約10日のみ出現し、主にM7発生日の直前または当日
   - **スコア5.0以上**: 約25日のみ出現し、M7発生日との関連性が非常に高い
   - **成功事例**:
     - 2025年12月8日 M7.6: 11月9日にスコア6.85を検出（29日前）
     - 2024年1月1日 M7.6: 12月26日にスコア5.2を検出（6日前）
     - 2016年4月16日 M7.3: 4月14日にスコア5.4を検出（2日前）
     - 2011年3月11日 M7.5-7.6: 3月10日にスコア4.5を検出（1日前）
   - **地域差**: 東北沖、北陸、熊本地方は発生日直前の高いスコア（5.0以上）
   - **推奨閾値**: スコア5.0以上で警戒レベル、スコア6.0以上で高度警戒レベル
   - 詳細は `データ分析結果出力/特徴探索結果/comprehensive_m7_analysis_report.md` を参照

2. **M7発生前30日のパターン（詳細統計）**
   - 平均M: 2.9〜3.6（平均3.3程度）
   - 発生回数が多い場合（55回/日以上）は要注意
   - 標準偏差が小さい傾向

3. **世界M7発生後の国内地震リスク**
   - 世界M7発生後7日間は国内地震のリスクが高まる
   - スコア加算の候補（+0.5〜+1.0）

4. **地域間の相関**
   - 石川県能登地方 ↔ 能登半島沖: 相関係数0.94
   - 岩手県沖 ↔ 茨城県沖: 相関係数0.87
   - 相関係数 > 0.8 の地域ペアで連動

5. **GNSS地殻変動データ** ⭐⭐⭐⭐
   - **発見**: GNSSデータは総合スコアの約67%を占める重要な指標
   - **評価項目**:
     - 変動量スコア: 最大変動量が50mm以上で+2.0、20mm以上で+1.0
     - 継続性スコア: 連続14日以上変動で+2.0、7日以上で+1.0
     - 同時変動スコア: 5地点以上同時変動で+2.0、3地点以上で+1.0
   - **注意**: GNSSデータは更新遅延があるため、最新データでは`--no-gnss`モード推奨
   - **出力ファイル**: `total_with_gnss.csv`（GNSSあり）、`total_no_gnss.csv`（GNSSなし）

6. **b値（グーテンベルク・リヒター則）** ⭐⭐⭐
   - **発見**: b値の低下は大地震の前兆の可能性を示唆
   - **計算方法**: Aki-Utsu法（離散補正あり）
   - **ベースライン**: 平均b値 0.295（標準偏差 0.036）
   - **スコアリング**: ベースラインからの相対的な低下をZ値で評価
     - 2σ以上低い: +2.0（高リスク）
     - 1.5σ以上低い: +1.5（中〜高リスク）
     - 1σ以上低い: +1.0（中リスク）
     - 0.5σ以上低い: +0.5（低リスク）
   - **効果**: 東日本大震災余震群、熊本地震、福島県沖M7.3などで前兆を検出

### その他の有用な特徴
5. **マグニチュードトレンド**（7日・30日移動平均）
6. **分布形状特徴**（歪度・尖度）
7. **深さとマグニチュードの関係**
8. **季節性パターン**（春は活動が活発）

詳細は `データ分析結果出力/特徴探索結果/活用可能な特徴まとめ.md` を参照してください。

## 🚀 実行方法

### スコア計算の実行
```bash
# GNSSスコアを含む（デフォルト）
python ソース/calculate_scores.py

# GNSSスコアなし（GNSSデータが古い場合に推奨）
python ソース/calculate_scores.py --no-gnss
```

### グラフ作成の実行
```bash
# 方法1: Pythonスクリプトから直接実行
python ソース/create_graphs.py

# 方法2: PowerShellスクリプトから実行（推奨）
powershell -ExecutionPolicy Bypass -File "グラフ\グラフ作成実行.ps1"

# 方法3: バッチファイルから実行（文字化け問題がある場合あり）
グラフ\グラフ作成実行.bat
```

### 特徴探索の実行
```bash
python ソース/explore_features.py
```

### M7前兆パターン分析の実行

#### 包括的分析の実行
```bash
# プロジェクトルートから実行
python scripts/analysis/comprehensive_m7_analysis.py
```

#### 個別分析の実行
```bash
# 11月のスコア分析
python scripts/analysis/analyze_november.py

# 12月のM7地震との関連確認
python scripts/analysis/check_m7_december.py

# M7前兆パターン分析
python scripts/analysis/analyze_m7_precursor_patterns.py
```

### データ自動取得の実行

#### 国内地震データの取得
```bash
# 方法1: ラッパースクリプトから実行（推奨、プロジェクトルートから実行）
python scripts/data_fetch/fetch_earthquake_data.py

# 方法2: 実スクリプトから直接実行（データ自動取得フォルダ内から実行）
cd データ自動取得/src
python fetch_earthquake_data.py

# デバッグモード
python scripts/data_fetch/fetch_earthquake_data.py --debug
```

#### 世界地震データの取得
```bash
# 方法1: ラッパースクリプトから実行（推奨、プロジェクトルートから実行）
python scripts/data_fetch/fetch_world_earthquake_data.py

# 方法2: 実スクリプトから直接実行（データ自動取得フォルダ内から実行）
cd データ自動取得/src
python fetch_world_earthquake_data.py

# デバッグモード
python scripts/data_fetch/fetch_world_earthquake_data.py --debug
```

#### 深さデータの取得
```bash
# 方法1: ラッパースクリプトから実行（推奨、プロジェクトルートから実行）
python scripts/data_fetch/fetch_depth_data.py

# 方法2: 実スクリプトから直接実行（データ自動取得フォルダ内から実行）
cd データ自動取得/src
python fetch_depth_data.py

# デバッグモード
python scripts/data_fetch/fetch_depth_data.py --debug

# Seleniumを明示的に指定
python scripts/data_fetch/fetch_depth_data.py --selenium
```

**注意**: 
- ラッパースクリプト（`scripts/data_fetch/`）はプロジェクトルートから実行してください
- 実スクリプト（`データ自動取得/src/`）はデータ自動取得フォルダ内から実行するか、絶対パスで指定してください
- データファイルは `データ自動取得/data/` に保存されます

## 📦 必要なパッケージ

`requirements.txt` に記載されています。主なパッケージ：

### 分析用パッケージ
- pandas >= 2.0.0
- numpy >= 1.24.0
- matplotlib >= 3.7.0
- scipy >= 1.10.0

### データ自動取得用パッケージ（新規追加）
- requests >= 2.31.0
- beautifulsoup4 >= 4.12.0
- lxml >= 4.9.0
- python-dateutil >= 2.8.0
- selenium >= 4.15.0（深さデータ取得で使用）

インストール方法：
```bash
pip install -r requirements.txt
```

**注意**: Seleniumを使用するには、ChromeDriverが必要です。ChromeDriverは自動的に管理される場合がありますが、手動でインストールが必要な場合もあります。

## 📊 出力ファイル

### スコア計算結果
- `japan_scores.csv`: 国内地震スコア（日毎）
- `world_scores.csv`: 世界地震スコア（日毎）
- `depth_scores.csv`: 深さスコア（日毎）
- `gnss_scores.csv`: GNSSスコア（日毎、地殻変動に基づく）
- `b_value_scores.csv`: b値スコア（日毎、b値とスコアを含む）
- `total_with_gnss.csv`: 総合スコア（国内+世界+深さ+GNSS+b値）
- `total_no_gnss.csv`: 総合スコア（国内+世界+深さ+b値、GNSSなし）

### データ自動取得結果（`データ自動取得/`フォルダ内）
- `data/2010-all.csv`: 国内地震データ（自動更新）
- `data/world-all.csv`: 世界地震データ（自動更新）
- `data/depth.csv`: 深さデータ（自動更新）
- `data/atmospheric.csv`: 気圧データ
- `src/YYYYMMDD/*_backup_*.csv`: バックアップファイル（日付別）
- `src/YYYYMMDD/*_new_data_*.csv`: 新規取得データのログ（日付別）
- `YYYYMMDD/*_backup_*.csv`: バックアップファイル（日付別、旧形式）
- `YYYYMMDD/*_new_data_*.csv`: 新規取得データのログ（日付別、旧形式）
- `debug/debug_html_*.html`: デバッグ用HTMLファイル（深さデータ取得時）

**注意**: 
- データファイルは `データ自動取得/data/` に保存されます
- 分析に使用するデータは `生データ/` フォルダにも配置されています（手動でコピーする必要がある場合があります）

### 特徴探索結果（`データ分析結果出力/特徴探索結果/`フォルダ内）
- `regional_statistics.csv`: 地域別統計
- `regional_correlations.csv`: 地域間の相関
- `magnitude_trends.csv`: マグニチュードトレンド
- `pre_m7_patterns.csv`: M7発生前30日のパターン
- `pre_m7_distribution_features.csv`: M7発生前の分布特徴
- `post_world_m7_patterns.csv`: 世界M7発生後の国内地震パターン
- `world_japan_correlation.csv`: 世界・国内地震の相関
- `depth_category_statistics.csv`: 深さカテゴリ別統計
- `depth_magnitude_relationship.csv`: 深さとマグニチュードの関係
- `monthly_statistics.csv`: 月別統計
- `seasonal_statistics.csv`: 季節別統計
- `magnitude_distribution_features.csv`: 分布特徴量
- `consecutive_periods.csv`: 連続発生期間
- `feature_exploration_report.md`: 特徴探索レポート
- `m7_precursor_score_analysis.md`: M7前兆スコア分析レポート
- `comprehensive_m7_analysis_report.md`: M7包括的分析レポート（**重要**）
- `scientific_evaluation_report.md`: 科学的評価レポート（研究機関向け）
- `活用可能な特徴まとめ.md`: 活用可能な特徴のまとめ

## 🔄 次のステップ（推奨）

### 優先度：最高 ⭐⭐⭐⭐⭐
1. **M7前兆スコアパターンの実用化**
   - スコア5.0以上で警戒レベル、スコア6.0以上で高度警戒レベル
   - リアルタイム監視システムの構築
   - 警告システムの実装（黄色/オレンジ/赤色警告）
   - 詳細は `データ分析結果出力/特徴探索結果/comprehensive_m7_analysis_report.md` を参照

### 優先度：高
2. **M7発生前30日のパターンをスコア計算に組み込む**
   - `calculate_scores.py` に追加
   - 過去30日の平均M、発生回数、標準偏差を監視
   - スコア5.0以上、6.0以上の検出機能を追加

3. **世界M7発生後の国内地震リスクをスコア計算に組み込む**
   - 世界M7発生後7日間はスコア加算（+0.5〜+1.0）

4. **地域間の相関をスコア計算に組み込む**
   - `データ分析結果出力/特徴探索結果/regional_correlations.csv` を読み込み
   - 相関係数 > 0.8 の地域ペアで連動スコア加算

5. **前向き研究（Prospective Study）の実施**
   - 実際の予測性能の検証
   - 交差検証の実施
   - 独立したテストデータでの検証

### 優先度：中
4. **マグニチュードトレンドの活用**
   - 7日移動平均と30日移動平均の比較
   - 変化率の急激な変化を検出

5. **分布形状特徴の活用**
   - 歪度 > 0.5 かつ 尖度 < -0.5 の場合にスコア加算

### 優先度：低
6. **季節性パターンの適用**
   - 季節調整係数の適用（検証が必要）

## 📝 実装例

新しい特徴をスコア計算に組み込む例は、`データ分析結果出力/特徴探索結果/活用可能な特徴まとめ.md` の「実装例：スコア計算への組み込み」セクションを参照してください。

## ⚠️ 注意事項

1. **Python環境**
   - 仮想環境（`.conda/python.exe`）を使用している場合は、その環境でパッケージをインストールしてください
   - `requirements.txt` のエンコーディングはUTF-8です

2. **データファイル**
   - 生データは `生データ/` フォルダに配置してください
   - 日付形式の違い（`12月9日` vs `2010/1/2`）に対応済み

3. **実行時間**
   - 特徴探索スクリプトの実行には数分かかる場合があります（データ量によります）

## 📚 参考ドキュメント

- `仕様書/地震データ分析システム仕様書.md`: システムの詳細仕様
- `docs/特徴探索ガイド.md`: 特徴探索スクリプトの使い方
- `データ分析結果出力/特徴探索結果/活用可能な特徴まとめ.md`: 発見された特徴の詳細と活用方法
- `データ分析結果出力/特徴探索結果/comprehensive_m7_analysis_report.md`: **M7地震前兆パターン包括的分析レポート（重要）**
- `データ分析結果出力/特徴探索結果/scientific_evaluation_report.md`: 科学的評価レポート（研究機関向け）
- `データ分析結果出力/特徴探索結果/m7_precursor_score_analysis.md`: M7前兆スコア分析レポート

## 🔧 トラブルシューティング

### パッケージが見つからないエラー
```bash
# 現在のPython環境を確認
python --version

# パッケージをインストール
pip install pandas numpy matplotlib scipy

# または、requirements.txtから
pip install -r requirements.txt
```

### エンコーディングエラー
- `requirements.txt` はUTF-8エンコーディングで保存されています
- 日本語コメントは英語に変更済みです

## 📞 連絡先・メモ

プロジェクトの状態を記録しました。次回作業を再開する際は、このファイルを確認してください。

## 🔄 データ自動取得機能の詳細

### 国内地震データ取得（`fetch_earthquake_data.py`）
- **データソース**: Yahoo!天気・災害（https://typhoon.yahoo.co.jp/weather/jp/earthquake/list/）
- **取得データ**: 日付、震源地、マグニチュード
- **更新頻度**: 手動実行
- **特徴**: 
  - 日付形式の自動変換（"YYYY年MM月DD日 HH時MM分ごろ" → "MM月DD日"）
  - 重複データの自動チェック
  - レート制限対応（1秒待機）

### 世界地震データ取得（`fetch_world_earthquake_data.py`）
- **データソース**: USGS Earthquake Catalog API（https://earthquake.usgs.gov/earthquakes/search/）
- **取得データ**: 日付、震源地、マグニチュード（M6.0以上）
- **更新頻度**: 手動実行
- **特徴**:
  - 既存データの最新日付から自動的に開始
  - API形式のCSVデータを直接取得
  - 重複データの自動チェック

### 深さデータ取得（`fetch_depth_data.py`）
- **データソース**: F-net（防災科研）（https://www.fnet.bosai.go.jp/event/joho.php）
- **取得データ**: 日付、深さ（300km以上のみ）
- **更新頻度**: 手動実行（直近2ヶ月を自動取得）
- **特徴**:
  - Seleniumを使用したJavaScript対応
  - テーブル構造の自動解析（class="sret_02"のテーブルを特定）
  - 気象庁とMT解の両方の深さを確認し、大きい方を採用
  - 重複チェック機能（既存データとの重複、取得データ内の重複）
  - デバッグモードでHTMLファイルを保存

### データ自動取得の共通機能
- 作業日の日付でフォルダを作成
- 既存データのバックアップを自動保存
- 新規取得データのログを保存
- 重複データの自動チェック
- エラーハンドリングとログ出力

詳細は `データ自動取得/README.md` を参照してください。

---

## 📊 最新の主要成果（2025-12-21）

### M7地震前兆パターン分析の完了
- ✅ **26件のM7地震について前30日のスコアパターンを網羅的に分析**
- ✅ **10件の主要M7地震で100%の前兆パターンを確認**
- ✅ **スコア6.0以上は約10日のみ出現し、M7発生日との関連性が極めて高い**
- ✅ **スコア5.0以上は約25日のみ出現し、M7発生日との関連性が高い**
- ✅ **地域別のパターン差異を識別**
- ✅ **偽陽性の分析と閾値の最適化を実施**
- ✅ **包括的分析レポートと科学的評価レポートを作成**

### プロジェクトファイルの整理完了
- ✅ **スクリプトを`scripts/`フォルダに整理**
- ✅ **ドキュメントを`docs/`フォルダに整理**
- ✅ **プロジェクト構造が明確になり、保守性が向上**

### 研究価値の評価
- ✅ **大学・研究機関での基礎研究データとして高い価値があると評価**
- ✅ **気象庁での補助的な参考資料として活用可能**
- ✅ **科学的評価レポートを作成し、研究利用時の注意点を明確化**

---

## 🔧 グラフ作成実行スクリプトの改善（2025-12-31）

### 問題
- `グラフ/グラフ作成実行.bat`で文字化けが発生
- `echo`コマンドが`o`や`ho`として解釈される
- UTF-8 BOM付きで保存しても文字化けが解消されない

### 解決策
- ✅ PowerShellスクリプト版（`グラフ/グラフ作成実行.ps1`）を作成
- ✅ PowerShellスクリプトでUTF-8エンコーディングを明示的に設定
- ✅ パス処理を改善（`Join-Path`を使用）
- ✅ PowerShellスクリプトで正常に動作することを確認

### 実行方法
```powershell
# PowerShellスクリプト版（推奨）
powershell -ExecutionPolicy Bypass -File "グラフ\グラフ作成実行.ps1"

# または、右クリック → 「PowerShellで実行」
```

### 注意事項
- バッチファイル（`.bat`）は文字エンコーディングの問題で動作しない場合がある
- PowerShellスクリプト（`.ps1`）を使用することを推奨
- バッチファイルが必要な場合は、`スコア計算実行.bat`と同じエンコーディング（UTF-8 BOM付きまたはShift-JIS）で保存する必要がある

---

---

## 📊 GNSS・b値スコアの追加（2026-01-24）

### GNSSスコアの実装
- ✅ **GNSS地殻変動データに基づくスコア計算を追加**
- ✅ **評価項目**: 変動量、継続性、同時変動の3つの観点で評価
- ✅ **総合スコアの約67%を占める重要な指標**
- ✅ **`--no-gnss`オプション**: GNSSデータが古い場合にGNSSスコアを除外

### b値スコアの実装
- ✅ **グーテンベルク・リヒター則に基づくb値計算（Aki-Utsu法）**
- ✅ **ベースラインからの相対的な低下をZ値で評価**
- ✅ **複数のM7地震で前兆パターンを検出**
  - 2011年4月余震群: 最大スコア2.0
  - 2022年3月福島県沖M7.3: 最大スコア1.0
  - 2016年4月熊本地震M7.3: 最大スコア1.0
- ✅ **出力ファイル**: `b_value_scores.csv`（日毎のb値とスコア）

### 出力ファイルの変更
- `total.csv` → `total_with_gnss.csv`（GNSSあり）
- 新規追加: `total_no_gnss.csv`（GNSSなし）
- 新規追加: `gnss_scores.csv`
- 新規追加: `b_value_scores.csv`

---

**最終更新**: 2026-01-24
**状態**: GNSS・b値スコア追加完了、M7前兆パターン分析完了、プロジェクトファイル整理完了
