# 地震スコア分析システム - 現況と改善計画

**作成日**: 2026年1月23日
**バージョン**: 1.0

---

## 1. システム概要

### 1.1 目的
複数の地震関連データを統合し、日次スコアを算出することで、大規模地震（M7以上）の前兆パターンを検出するシステム。

### 1.2 現在の構成

```
52-2_cursor_地震/
├── ソース/                    # メイン処理
│   ├── calculate_scores.py   # スコア計算（503行）
│   ├── create_graphs.py      # グラフ作成（698行）
│   └── explore_features.py   # 特徴探索（661行）
├── データ自動取得/            # データ収集
│   └── src/
│       ├── fetch_earthquake_data.py       # 国内地震
│       ├── fetch_world_earthquake_data.py # 世界地震
│       ├── fetch_depth_data.py            # 深発地震
│       └── fetch_gnss_data.py             # GNSS変動
├── 生データ/                  # 入力データ
├── データ分析結果出力/        # 出力（CSV）
└── グラフ/                    # 出力（PNG）
```

---

## 2. スコア計算の仕組み

### 2.1 総合スコアの構成

```
総合スコア = 国内地震スコア + 世界地震スコア + 深さスコア + GNSSスコア
```

| スコア | 重み | データソース | 更新頻度 |
|--------|------|--------------|----------|
| 国内地震 | 主要 | Yahoo!天気・災害 | 即時 |
| 世界地震 | 補助 | USGS API | 即時 |
| 深さ | 補助 | F-net（防災科研） | 日次 |
| GNSS | 補助 | 国土地理院 | 日次 |

### 2.2 国内地震スコア（詳細）

**基本条件による加算:**

| 条件 | スコア | 説明 |
|------|--------|------|
| 静穏化（3日） | +1.0 | 1日3回以内が3日連続 |
| 静穏化（6日） | +2.0 | 1日3回以内が6日連続 |
| 活発化 | +1.0 | 当日10回以上 & 過去30日M6.5以下 |
| M5多発（5回） | +0.5 | M5以上が5回以上 |
| M5多発（10回） | +1.0 | M5以上が10回以上 |
| 特定地域 | +1.0 | 日向灘、択捉島南東沖など |
| 急増 | +1.0 | 過去3日平均の2倍以上 |
| 局所集中 | +1.0 | 同一地域5回以上 |

**M7.5前兆強化:**

| 条件 | スコア | 説明 |
|------|--------|------|
| 平均M異常 | +1.5 | 30日平均M: 3.0〜3.5で発生急増 |
| 前震候補（M7.5） | +2.0 | 30日以内にM5〜M6.9が3回以上 |
| 前震候補（M7） | +1.5 | 30日以内にM5〜M6.9が3回以上 |

### 2.3 世界地震スコア

```
スコア = Σ(マグニチュード別加点) / 20

- M6.0以上: +1
- M7.0以上: +2
- M7.5以上: +2（追加）
- M8.0以上: +3
```

### 2.4 深さスコア

```
スコア = Σ(深さ別加点) / 20

- 300km以上: +1
- 400km以上: +2
- 500km以上: +3
```

### 2.5 GNSSスコア

| 評価項目 | 条件 | スコア |
|----------|------|--------|
| 変動量 | 50mm以上 | +2.0 |
| 変動量 | 20mm以上 | +1.0 |
| 変動量 | 10mm以上 | +0.5 |
| 継続性 | 14日以上 | +2.0 |
| 継続性 | 7日以上 | +1.0 |
| 継続性 | 3日以上 | +0.5 |
| 同時変動 | 5地点以上 | +2.0 |
| 同時変動 | 3地点以上 | +1.0 |

---

## 3. 現在の精度

### 3.1 M7地震前兆検出実績

**検出率: 100%**（分析した主要10件全て）

| 地震日 | M | 前兆検出日 | スコア | リードタイム |
|--------|---|------------|--------|--------------|
| 2025/12/8 | 7.6 | 11/9 | 6.85 | 29日前 |
| 2024/1/1 | 7.6 | 12/26 | 5.2 | 6日前 |
| 2016/4/16 | 7.3 | 4/14 | 5.4 | 2日前 |
| 2011/3/11 | 7.5-7.6 | 3/10 | 4.5 | 1日前 |

### 3.2 スコア閾値の意味

| スコア | 出現日数 | 意味 |
|--------|----------|------|
| 6.0以上 | 約10日 | 高度警戒（M7発生との関連極めて高い） |
| 5.0以上 | 約25日 | 警戒（M7発生との関連高い） |
| 4.0以上 | 約100日 | 注意（偽陽性あり） |

### 3.3 課題：偽陽性

- スコア4.0以上：偽陽性が存在
- スコア5.0以上：偽陽性が大幅に減少
- スコア6.0以上：偽陽性はほぼなし

---

## 4. 改善点と優先度

### 4.1 精度向上のための改善案

#### 優先度：最高 ⭐⭐⭐⭐⭐

**1. 地域別スコアの導入**
- 現状：全国一律のスコア計算
- 改善：地域ごとに重み付けを変える
- 効果：地域特性を反映し、偽陽性を削減

```python
# 改善案
regional_weights = {
    '南海トラフ': 1.5,    # 日向灘、紀伊半島沖など
    '首都直下': 1.3,      # 茨城県沖、千葉県東方沖など
    '東北沖': 1.2,        # 岩手県沖、宮城県沖など
    'その他': 1.0
}
```

**2. 時間窓の最適化**
- 現状：固定30日窓
- 改善：7日、14日、30日の複合評価
- 効果：短期・中期の両方のパターンを捕捉

```python
# 改善案
windows = [7, 14, 30]
weighted_score = sum(
    calculate_window_score(window) * weight
    for window, weight in zip(windows, [0.3, 0.3, 0.4])
)
```

**3. b値（Gutenberg-Richter則）の導入**
- 現状：マグニチュードの単純カウント
- 改善：b値の異常を検出
- 効果：科学的根拠のある指標を追加

```python
# 改善案：b値計算
def calculate_b_value(magnitudes, mc=2.0):
    """
    b = log10(e) / (mean_M - mc)
    b値が低下 → 大地震の前兆の可能性
    """
    filtered = [m for m in magnitudes if m >= mc]
    if len(filtered) < 10:
        return None
    mean_m = np.mean(filtered)
    b = np.log10(np.e) / (mean_m - mc)
    return b
```

#### 優先度：高 ⭐⭐⭐⭐

**4. GNSS観測地点の拡大**
- 現状：7地点（東京、横浜、静岡、名古屋、大阪、神戸、広島）
- 改善：15〜20地点へ拡大
- 追加候補：仙台、福岡、那覇、札幌、新潟、金沢、高知

**5. 深発地震データの充実**
- 現状：692件（2010年以降）
- 改善：観測網の拡大、データソース追加
- 効果：深発地震との相関をより正確に評価

**6. 機械学習モデルの導入**
- 現状：ルールベースのスコア計算
- 改善：ランダムフォレストやXGBoostによる予測
- 効果：非線形パターンの捕捉

```python
# 改善案
from sklearn.ensemble import RandomForestClassifier

features = [
    'japan_score', 'world_score', 'depth_score', 'gnss_score',
    'b_value', 'avg_magnitude_7d', 'avg_magnitude_30d',
    'count_7d', 'count_30d', 'max_magnitude_7d'
]
model = RandomForestClassifier(n_estimators=100)
```

#### 優先度：中 ⭐⭐⭐

**7. リアルタイム監視の実装**
- 現状：バッチ処理（手動実行）
- 改善：定期自動実行 + 閾値超過時の通知

**8. 季節性の考慮**
- 現状：季節性を考慮していない
- 改善：季節調整係数の導入
- 根拠：春は地震活動が活発な傾向あり

**9. 相関地域ペアの活用**
- 現状：地域間相関を利用していない
- 改善：高相関ペア（石川-能登: 0.94）を活用

---

## 5. 具体的な実装計画

### Phase 1: 基盤改善（1-2週間）

1. **b値計算の追加**
   - `calculate_scores.py`に`calculate_b_value()`を追加
   - 30日窓でb値を計算し、平常時からの乖離をスコア化

2. **時間窓の複合評価**
   - 7日、14日、30日の3つの窓で評価
   - 重み付け平均でスコアを算出

### Phase 2: データ拡充（2-3週間）

3. **GNSS観測地点の追加**
   - `fetch_gnss_data.py`に追加地点を設定
   - 15地点へ拡大

4. **地域別重み付けの導入**
   - 地域マスターの作成
   - スコア計算に地域係数を適用

### Phase 3: 高度化（1ヶ月）

5. **機械学習モデルの構築**
   - 特徴量エンジニアリング
   - モデル学習と評価
   - 既存スコアとのアンサンブル

---

## 6. 評価指標

### 6.1 現在の指標

| 指標 | 現在値 | 目標値 |
|------|--------|--------|
| M7検出率 | 100% | 100%維持 |
| 偽陽性率（スコア5.0以上） | 約20% | 10%以下 |
| リードタイム（平均） | 約10日 | 14日以上 |

### 6.2 追加評価指標（提案）

- **精度（Precision）**: TP / (TP + FP)
- **再現率（Recall）**: TP / (TP + FN)
- **F1スコア**: 2 * (Precision * Recall) / (Precision + Recall)
- **AUC-ROC**: 閾値に依存しない総合性能

---

## 7. 参考：データ統計

### 7.1 データ量

| データ | 行数 | 期間 |
|--------|------|------|
| 国内地震 | 45,411 | 2010年〜 |
| 世界地震 | 2,304 | 2010年〜 |
| 深発地震 | 692 | 2010年〜 |
| GNSS | 40,776 | 2010年〜 |

### 7.2 M7以上地震（2010年以降、国内）

| 日付 | 場所 | M |
|------|------|---|
| 2011/3/11 | 三陸沖 | 9.0 |
| 2016/4/16 | 熊本 | 7.3 |
| 2024/1/1 | 能登半島 | 7.6 |
| 2025/12/8 | 日向灘 | 7.6 |

---

## 8. 次のアクション

1. **b値計算の実装**（今週中）
2. **時間窓の複合評価**（今週中）
3. **GNSS地点追加**（来週）
4. **評価指標の整備**（来週）
5. **機械学習モデル検討**（再来週以降）

---

*このドキュメントは定期的に更新されます*
